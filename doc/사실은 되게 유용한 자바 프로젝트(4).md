# 사실은 되게 유용한 자바 프로젝트(4)

## Jsoup로 세계 대학 순위 크롤링 하기

오늘은 Jsoup를 이용한 크롤링을 해볼 예정입니다. tsv writer와 tsv parser 설명은 어렵지 않아서 생략하고 시간이 날 때(ㅎㅎ) 설명을 추가하겠습니다.

### Jsoup?

Jsoup는 자바로 웹 사이트 크롤링을 할 수 있도록 도와주는 라이브러리입니다.  html 파일이나, 웹 페이지에 접속하여 원하는 정보만 가져올수 있습니다. 그런 면에서 Jsoup는 엄밀히 말해 crawler 보다는 parser라고 볼 수 있습니다.

https://jsoup.org



### Crawler vs Parser

crawler는 하나의 웹 페이지로부터 시작하여 해당 페이지에 있는 링크들을 재귀적으로 타고들어가 웹 페이지들을 그득그득 긁어오는 것에 가깝습니다.  우리가 원하는 정보의 형태로 추출해오는 것이 아닙니다. 구글 같은 검색 엔진은 문서 인덱싱을 위한 자체 crawler를 가지고 있습니다.

parser는 하나의 웹 페이지에서 원하는 정보들을 선별적으로 추출하여 원하는 정보의 형태로 가져올 수 있습니다. 보통은 xpath나 css selector를 통해서 정보들을 추출합니다. 

관련 내용 참고:

<https://stackoverflow.com/questions/53304955/web-crawler-vs-html-parser>

+우리 프로젝트의 CrawlingController 클래스를 통해 crawler를 실행해보면 확실한 차이를 느낄 수 있습니다.



### Jsoup 'parser' usage

Jsoup의 기본적 사용법은 두 가지입니다.

첫번째, Jsoup 자체 method를 이용해서 원하는 정보에 접근하는 방법입니다.

```getElementByTag``` 이런식으로요.

그러나 웹 사이트 마다 세부적인 DOM 구조가 다 다르기 때문에 불필요한 정보까지 가져오게 되는 경우가 많아 제가 선호하는 방법은 아닙니다. 



두번째, CSS selector를 이용해서 원하는 정보에 접근하는 방법입니다. 세부적인 접근이 가능한 방법입니다.

```select ``` 함수의 아규먼트로  css selector 값을 넘기면 됩니다.



### CSS selector notation 이해하기

그렇다면, CSS selector는 어떤 식으로 표현이 될까요?

#### \#

#은 id를 의미합니다. 

```HTML
<div id="바로여기">가져오고 싶은 정보</div>
```

```select("#바로여기")``` 이런식으로 사용하면 id가 '바로여기'인 원소들을 가져오게 됩니다.



#### .

.은 class를 의미합니다.

```HTML
	<div class="바로여기">가져오고 싶은 정보</div>
```

```select(".바로여기")``` 이런식으로 사용하면 class가 '바로여기'인 원소들을 가져오게 됩니다.



#### a[href]

a는 HTML 태그의 일종입니다. []는 특정 태그의 attribute를 의미합니다. 이 예시에서는 a태그의 href attribute들을 가져오겠다는 의미입니다.

```HTML
<a href="url주소">웹페이지에서 보이는 파란글씨</div>
```



#### div .classname

태그등 특정 요소 아래에 있는 클래스들만 가져오는 활용도 가능합니다.  자손들을 가져오기 때문에 여러개의 클래스를 가져오거나, 하위 depth와 무관하게 classname과 일치하면 모두 가져오게 됩니다. 이 예시에서는 div 태그 아래에 있는 classname을 가진 class들을 모두 가져오게 됩니다.



#### h3.r > a

\>는 특정 요소 바로 아래에 있는 요소만 가져오는 notation입니다. 이 예시에서는 h3 태그 아래에 있는 r 클래스들의 바로 아래에 있는 a 태그만 가져옵니다.

위의 내용을 다 이해했다면 다음과 같은 활용도 가능합니다.ㅎㅎ

```css
answer-53703616 > div > div.answercell.post-layout--right > div.post-text > p:nth-child(3) > a
```



### 개발자 도구 사용하기

이제 CSS Selector에 대해서 이해를 했으니 원하는 정보들을 뽑아올 시간입니다. 



### 크롤링 로직 작성하기



### 대학순위 100위까지 크롤링하기(a.k.a 10 페이지 크롤링하기)

