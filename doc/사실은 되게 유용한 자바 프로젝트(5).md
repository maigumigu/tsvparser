# 사실은 되게 유용한 자바 프로젝트(5)

와! 드디어 마지막 시간입니다. 아직 얘기할 것은 산더미 같이 남아있긴 합니다.  

1. tsv writer와 tsv parser 코드에 대한 설명
2. Java의 Collection과 Lambda의 활용 
3. Logger 사용하기
4. JUnit으로 테스트 코드 작성하기
5. 개발자 도구에서 콘솔창 사용하기
6. 등등...

하지만 글로 내용을 전달하기란 정말 쉽지 않다는 것을 깨닫는 시간이었습니다. ~~퇴고는 이제 그만하고 싶습니다.~~

스터디에서 했던 내용을 먼저 끝내고 힘이 닿는 대로 추가적인 내용을 정리해보도록하겠습니다. 

오늘은 구현한 크롤러의 결과를 DB에 저장해보겠습니다.

## 크롤러의 결과 DB에 저장

### DAO와 DTO

지난번에 패키징시간에 프로그램 플로우에 대해서 언급했습니다. 그러면서 DTO 객체와 DAO 객체에 대해서 간단히 언급하고 넘어갔습니다. 그런데 두 객체에 대한 이해를 해야 오늘 할 것이 명확해질 것 같습니다.

![img](https://lh3.googleusercontent.com/KycrL6y3MAI1qjAckpsEZSEMa0FNP5JgYTZiD82TVN3U0Gm6X63luhflLODla2s5ssJsh7k-ARYua5mR7lmxZJMKQwY05SCIic0FinJAdkeJ7IcQ9EWDsoJwxJ50N8g7-2Dty3OC)



> DTO는

Data Transfer Object의 약자입니다. 한국말로는 데이터 전송객체입니다. 웹 개발에서 각 레이어간에 **정해진 포맷의 데이터**를 넘길 때 사용합니다. 이 프로젝트에서 해당 DTO의 개념을 가져와 모듈간 데이터를 주고 받도록 사용하였습니다.

우리가 사용하는 UnivRankDTO는 대학이름, 순위, 나라이름을 가지고 있고, UnivRankDTO의 리스트가 모듈간 이동을 하고 있다고 보면 됩니다. 

> DAO는 

Data Access Object의 약자입니다. 한국말로는 데이터 접근 객체입니다. DB에 접근하는 역할을 가진 객체를 분리함으로써 각 모듈이 각자의 역할에 충실할 수 있도록 할 수 있습니다.



그렇다면 DTO 리스트를 DAO가 받아서 DB에 저장하는 구조인 것을 이해할 수 있습니다.

그런데 그림에 있던 Domain은 설명하지 않았습니다. Domain에 대해 알기 위해서는 ORM에 대해 먼저 알아야 합니다.

### 갑분 ORM 설명

ORM은 Object-Relational Mapping의 준말로, 한국말로는 객체 관계 매핑입니다. 그런데 좀 객체와 관계라는 말이 안 어울리지 않나요? 

객체는 객체지향프로그래밍에서 등장하는 개념이고, 관계는 데이터베이스에서 등장하는 개념입니다. 객체지향과 데이터베이스는 설계의도 자체가 다른데 어떻게 연결시키겠다는 것일까요?

결국은 개발자 입장을 생각하게 됩니다. 객체지향에 익숙한 개발자들은 DB를 조회하는 어플리케이션을 만들때 일일이 SQL문을 만들어야했습니다. JDBC를 써보신 분들은 잘 아실 겁니다. JDBC를 개선해 만든 Mybatis도 SQL문을 일일이 작성해야 한다는 점에서는 동일했습니다. 

ORM 기술은 프로그램의 객체지향성을 유지하면서, 데이터에도 쉽게 접근할 수 있는 기술입니다.

### ORM과 JPA

JPA는 JAVA PERSISTENT API의 준말로, ORM은 자바에서 이렇게 사용해야 한다는 스펙의 리스트업입니다. 그러므로 구현된 프레임워크 형태는 아닙니다. ORM의 대표적인 구현체는 Hibernate입니다.

그렇다면 Hibernate 같은 ORM 기술을 사용하여 어플리케이션을 개발하면 장단점이 뭘까요?

### ORM 장단점

#### 장점

> **객체지향성**의 유지

SQL을 직접적으로 작성하도록 만드는 mapper와의 가장 큰 차이점이라고도 할 수 있습니다.

> 생산성과 유지보수

객체지향의 맥락에서 빠른 개발이 가능합니다.

### 단점

> 높은 Learning Curve

애매하게 적용하는 것은 정말 쉽지만 '잘' 쓰려면 알아야 할 것이 많습니다. 현업에서 Spring Data JPA와 Query DSL을 사용해 개발하면서 ORM 기술이 추상화된만큼 내가 정말 잘 쓰고 있는 것인지 고민이 될 때가 많았습니다. 

> 세밀한 쿼리 작업 어려움

세밀한 데이터 조작이나 조회가 필요한 경우 ORM 구현체에서 지원하지 않는 기능일때도 있습니다. SQL에서 되는 기능을 가져와서 쓰려고 할 때 열심히 찾아봐도 해당 기능을 지원하지 않을 때가 (여러번) 있었습니다. 이 부분은 제가 잘 몰라서 그러는 것일 수도 있습니다. 첫번째 단점과 비슷한 이야기지만 지식적 접근성의 문제일수도 있고요. 

### MyBatis vs Hibernate

구글 트렌드에서 대표적인 mapper인 MyBatis와 대표적 JPA 구현체인 Hibernate를 키워드로 검색해보았습니다. 아시아권에서는 Mybatis가 우세하지만 전세계적으로는 ORM이 우세한 것을 볼 수 있습니다.

https://trends.google.co.kr/trends/explore?q=%2Fm%2F04t80p,%2Fm%2F0fqmvs4

![img](https://lh4.googleusercontent.com/dH1ey8ALX0qze80mBv7RGO8aFuN8AmEdgSPttDvM7V9qsDyEh3BW4qPNJOziYtHVS9lmOWJCmOTAK_tz7TNMC5GSxyN9GfTMZfNegofdFht2aIAARd1J9M54fAID-KJtWqSkaTB6xYA)



어쨌든, SQL mapper를 사용하든 JPA를 사용하든 장단점을 잘 고려하여 사용하면 될 것 같습니다.

### Hibernate



### H2 DB 설치하기

http://www.h2database.com/html/main.html

### hibernate.cfg.xml 파일 만들기

![img](https://lh5.googleusercontent.com/jzPNVKJHo64dy-KMsyUkFg16PPJVIsODKW7iwt_AqSEiD9-JVfBT9lZyjf8m0fz-fBldNagL1QnTw_puuwu-E9GHfKsIFawNzrPlucr5Pf3aZZa51dOVOvnQrCkw3lEb7dYemRU9AwQ)

```xml
<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE hibernate-configuration PUBLIC
        "-//Hibernate/Hibernate Configuration DTD//EN"
        "http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd">

<hibernate-configuration>
    <session-factory>
        <property name="connection.driver_class">org.h2.Driver</property>
<!--        <property name="connection.url">jdbc:h2:mem:test;DB_CLOSE_DELAY=-1</property>-->
        <property name="connection.url">jdbc:h2:tcp://localhost/~/test</property>
        <property name="dialect">org.hibernate.dialect.H2Dialect</property>
        <property name="hbm2ddl.auto">create</property>
        <property name="hibernate.connection.username">sa</property>
        <property name="hibernate.connection.password"></property>
        <property name="hibernate.show_sql">true</property>
        <property name="hibernate.use_sql_comments">false</property>
        <property name="hibernate.generate_statistics">false</property>
        <mapping class="main.java.data.UnivRank"/>
    </session-factory>
</hibernate-configuration>

```



### Entity Class 작성하기

```java
@Entity
@Table(name="univ_rank")
public class UnivRank {
   @Id
   @Column
   private String univName;
   @Column
   private String country;
   @Column
   private int rank;
}
```



### 디비 연동 후 프로그램 실행 결과

![img](https://lh4.googleusercontent.com/1VGRURi6auTVIzvrEhUrEx76IIMD_5pfDmRYKda1w3lai7K9AJsalsfooxZ-WMstFsGNJgyk6F7cbFsVnEH4I725erhdPB40PZWtPuOM47cqlOwPdYVND0PNjEk2u0kSNQqpGFYE)